import asyncio
from mcp import ClientSession        # <-- ‡∏ô‡∏µ‡πà‡∏Ñ‡∏∑‡∏≠‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡∏Ç‡∏≠‡∏á Client
from mcp.client.sse import sse_client # <-- ‡∏ô‡∏µ‡πà‡∏Ñ‡∏∑‡∏≠‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡∏Ç‡∏≠‡∏á Client

async def run_host():
    
    # --- ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô HOST (‡∏™‡∏°‡∏≠‡∏á) ---
    # Host ‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ô‡πÉ‡∏à‡∏ß‡πà‡∏≤ "‡∏â‡∏±‡∏ô‡∏à‡∏∞‡πÑ‡∏õ‡∏Ñ‡∏∏‡∏¢‡∏Å‡∏±‡∏ö Server ‡∏ó‡∏µ‡πà URL ‡∏ô‡∏µ‡πâ‡∏ô‡∏∞"
    server_url = "http://127.0.0.1:8000/sse"
    print(f"üîå Host: ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠...")

    # --- ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô CLIENT (‡∏õ‡∏≤‡∏Å/‡∏ó‡πà‡∏≠‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•) ---
    # ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡∏Å‡∏•‡πÑ‡∏Å Client ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠
    async with sse_client(server_url) as (read, write):
        async with ClientSession(read, write) as session:
            await session.initialize()
            
            # --- ‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏Ç‡∏≠‡∏á HOST (‡∏™‡∏°‡∏≠‡∏á) ---
            # Host ‡∏™‡∏±‡πà‡∏á: "‡∏Ç‡∏≠‡∏î‡∏π‡πÄ‡∏°‡∏ô‡∏π‡∏´‡∏ô‡πà‡∏≠‡∏¢ (List tools)"
            tools = await session.list_tools()
            print(f"üõ†Ô∏è Host: ‡πÄ‡∏à‡∏≠‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡πÅ‡∏•‡πâ‡∏ß -> {[t.name for t in tools.tools]}")

            # Host ‡∏™‡∏±‡πà‡∏á: "‡∏â‡∏±‡∏ô‡∏≠‡∏¢‡∏≤‡∏Å‡∏ö‡∏ß‡∏Å‡πÄ‡∏•‡∏Ç 50+50 ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏´‡∏ô‡πà‡∏≠‡∏¢"
            print("\nü§ñ Host: ‡∏™‡∏±‡πà‡∏á‡πÉ‡∏´‡πâ‡∏ö‡∏ß‡∏Å‡πÄ‡∏•‡∏Ç...")
            
            # --- ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô CLIENT (‡∏õ‡∏≤‡∏Å) ---
            # Client ‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏à‡∏≤‡∏Å Host ‡πÅ‡∏•‡πâ‡∏ß‡∏ß‡∏¥‡πà‡∏á‡πÑ‡∏õ‡∏Ñ‡∏∏‡∏¢‡∏Å‡∏±‡∏ö Server
            result = await session.call_tool("calculator_plus", arguments={"a": 50, "b": 50})
            
            # --- ‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏Ç‡∏≠‡∏á HOST (‡∏™‡∏°‡∏≠‡∏á) ---
            # Host ‡∏£‡∏±‡∏ö‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏°‡∏≤‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•
            print(f"üì® Host: ‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏Ñ‡∏∑‡∏≠ {result.content[0].text}")

            # --- ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô CLIENT (‡∏õ‡∏≤‡∏Å) ---
            # Client ‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏à‡∏≤‡∏Å Host ‡πÅ‡∏•‡πâ‡∏ß‡∏ß‡∏¥‡πà‡∏á‡πÑ‡∏õ‡∏Ñ‡∏∏‡∏¢‡∏Å‡∏±‡∏ö Server
            print("\nü§ñ Host: ‡∏™‡∏±‡πà‡∏á‡πÉ‡∏´‡πâ‡∏ó‡∏±‡∏Å‡∏ó‡∏≤‡∏¢...")
            result = await session.call_tool("say_hello", arguments={"name": "Somchai"})

            # --- ‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏Ç‡∏≠‡∏á HOST (‡∏™‡∏°‡∏≠‡∏á) ---
            # Host ‡∏£‡∏±‡∏ö‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏°‡∏≤‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•
            print(f"üì® Host: ‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏Ñ‡∏∑‡∏≠ {result.content[0].text}")

if __name__ == "__main__":
    asyncio.run(run_host())